name: Terraform

on: [push, pull_request]

jobs:
  terraform:
    name: Terraform
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Set up Terraform
      uses: hashicorp/setup-terraform@v1
    - name: Terraform Plan
      run: make tf-plan
    - name: Set up OPA
      uses: b4b4r07/action-opa@master
    - name: OPA evaluate Terraform Plan
      run: make opa-eval
